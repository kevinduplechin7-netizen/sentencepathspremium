const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/sample-5ee62926.js","assets/react-bc301c2f.js","assets/dexie-d9f8aec0.js","assets/vendor-7461c230.js","assets/backup-cf30dc23.js"])))=>i.map(i=>d[i]);
import{r as c,j as e,R as At,a as Ct}from"./react-bc301c2f.js";import{D as Ue}from"./dexie-d9f8aec0.js";import"./vendor-7461c230.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const u of r)if(u.type==="childList")for(const o of u.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&l(o)}).observe(document,{childList:!0,subtree:!0});function a(r){const u={};return r.integrity&&(u.integrity=r.integrity),r.referrerPolicy&&(u.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?u.credentials="include":r.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function l(r){if(r.ep)return;r.ep=!0;const u=a(r);fetch(r.href,u)}})();const Pt="modulepreload",Dt=function(t){return"/"+t},ot={},$=function(s,a,l){let r=Promise.resolve();if(a&&a.length>0){let x=function(N){return Promise.all(N.map(P=>Promise.resolve(P).then(i=>({status:"fulfilled",value:i}),i=>({status:"rejected",reason:i}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),g=o?.nonce||o?.getAttribute("nonce");r=x(a.map(N=>{if(N=Dt(N),N in ot)return;ot[N]=!0;const P=N.endsWith(".css"),i=P?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${N}"]${i}`))return;const p=document.createElement("link");if(p.rel=P?"stylesheet":Pt,P||(p.as="script"),p.crossOrigin="",p.href=N,g&&p.setAttribute("nonce",g),document.head.appendChild(p),P)return new Promise((v,k)=>{p.addEventListener("load",v),p.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${N}`)))})}))}function u(o){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=o,window.dispatchEvent(g),!g.defaultPrevented)throw o}return r.then(o=>{for(const g of o||[])g.status==="rejected"&&u(g.reason);return s().catch(u)})};function Rt(t){const s=t.replace(/[\u200B-\u200D\uFEFF]/g,"").trim();return s?s.split(/[\s.,;:!?(){}\[\]"'“”‘’—–\-_/\\|]+/g).filter(Boolean).length:0}function Et(t){return t.replace(/[\s\p{P}\p{S}]/gu,"").trim().length}function Ie(t,s){return s?Et(t):Rt(t)}function _t(t,s){const a=t.replace(/[\u200B-\u200D\uFEFF]/g,"").trim();if(!a)return[];if(s)return Array.from(new Set(a.replace(/[\s\p{P}\p{S}]/gu,"").split("").filter(Boolean)));const l=a.split(/[\s.,;:!?(){}\[\]"'“”‘’—–\-_/\\|]+/g).map(r=>r.trim()).filter(Boolean).map(r=>r.toLowerCase());return Array.from(new Set(l))}class Lt extends Ue{datasets;decks;imports;sentences;progress;pathProgress;srs;seenWords;stats;constructor(){super("sentencepaths_db"),this.version(1).stores({datasets:"id, name, languageTag, createdAt",sentences:"id, datasetId",progress:"datasetId"}),this.version(2).stores({datasets:"id, name, languageTag, createdAt",decks:"id, datasetId, createdAt, [datasetId+createdAt]",imports:"id, datasetId, deckId, createdAt, [datasetId+deckId+createdAt]",sentences:"id, datasetId, deckId, order, importId, [datasetId+deckId], [datasetId+deckId+order], [datasetId+deckId+importId]",progress:"datasetId",pathProgress:"&[datasetId+deckId], datasetId, deckId, updatedAt",srs:"&[datasetId+deckId+sentenceId], datasetId, deckId, dueAt, [datasetId+deckId+dueAt]"}).upgrade(async s=>{const a=await s.table("datasets").toArray();for(const l of a){const r=`deck_${l.id}`,u=s.table("decks");await u.get(r).catch(()=>{})||await u.add({id:r,datasetId:l.id,name:"Main",createdAt:l.createdAt??Date.now()});const g=s.table("sentences"),x=await g.where("datasetId").equals(l.id).toArray();x.sort((p,v)=>String(p.id).localeCompare(String(v.id)));for(let p=0;p<x.length;p++)x[p].deckId=r,x[p].order=p,x[p].importId="legacy";x.length&&await g.bulkPut(x);const N=await s.table("progress").get(l.id),P=s.table("pathProgress");if(!await P.get([l.id,r]).catch(()=>{})){const p=N?.currentIndex??0;await P.put({datasetId:l.id,deckId:r,mode:"linear",linearOrder:p,srsNewOrder:p,lifetimeReps:N?.lifetimeReps??0,lifetimeTokens:N?.lifetimeTokens??0,updatedAt:Date.now()})}}}),this.version(3).stores({datasets:"id, name, languageTag, createdAt",decks:"id, datasetId, createdAt, [datasetId+createdAt]",imports:"id, datasetId, deckId, createdAt, [datasetId+deckId+createdAt]",sentences:"id, datasetId, deckId, order, importId, [datasetId+deckId], [datasetId+deckId+order], [datasetId+deckId+importId]",progress:"datasetId",pathProgress:"&[datasetId+deckId], datasetId, deckId, updatedAt",srs:"&[datasetId+deckId+sentenceId], datasetId, deckId, dueAt, [datasetId+deckId+dueAt]",seenWords:"&[datasetId+token], datasetId, firstSeenAt",stats:"datasetId, updatedAt"}).upgrade(async s=>{const a=await s.table("datasets").toArray(),l=s.table("stats");for(const r of a)await l.get(r.id).catch(()=>{})||await l.put({datasetId:r.id,uniqueWordsSeen:0,updatedAt:Date.now()})}),this.version(4).stores({datasets:"id, name, languageTag, createdAt",decks:"id, datasetId, createdAt, [datasetId+createdAt]",imports:"id, datasetId, deckId, createdAt, [datasetId+deckId+createdAt]",sentences:"id, datasetId, deckId, order, importId, [datasetId+deckId], [datasetId+deckId+order], [datasetId+deckId+importId]",progress:"datasetId",pathProgress:"&[datasetId+deckId], datasetId, deckId, updatedAt",srs:"&[datasetId+deckId+sentenceId], datasetId, deckId, dueAt, [datasetId+deckId+dueAt]",seenWords:"&[datasetId+token], datasetId, firstSeenAt",stats:"datasetId, updatedAt"}).upgrade(async s=>{const a=await s.table("datasets").toArray(),l=await s.table("decks").toArray(),r=s.table("stats"),u=new Map;for(const i of a)u.set(i.id,!!i.cjkMode),await r.get(i.id).catch(()=>{})||await r.put({datasetId:i.id,uniqueWordsSeen:0,updatedAt:Date.now()});const o=s.table("sentences");await o.toCollection().modify(i=>{const p=u.get(i.datasetId)??!1,v=i.sourceText??i.english??i.source??i.en??i.front??i.prompt??"",k=i.targetText??i.target??i.answer??i.back??i.text??i.sentence??i.Target??"";(!i.sourceText||!String(i.sourceText).trim())&&typeof v=="string"&&v.trim()&&(i.sourceText=v),(!i.targetText||!String(i.targetText).trim())&&typeof k=="string"&&k.trim()&&(i.targetText=k),!i.transliterationText&&typeof i.transliteration=="string"&&(i.transliterationText=i.transliteration),!i.glossText&&typeof i.gloss=="string"&&(i.glossText=i.gloss),(typeof i.order!="number"||!Number.isFinite(i.order))&&(i.order=0);const S=String(i.targetText??"");(typeof i.tokenCount!="number"||!Number.isFinite(i.tokenCount)||i.tokenCount<=0)&&(i.tokenCount=Ie(S,p))});const g=new Map;for(const i of l){const p=await o.where("[datasetId+deckId]").equals([i.datasetId,i.id]).toArray();p.sort((k,S)=>(k.order??0)-(S.order??0)||String(k.id).localeCompare(String(S.id)));let v=!1;p.forEach((k,S)=>{k.order!==S&&(k.order=S,v=!0)}),v&&p.length&&await o.bulkPut(p),g.set(`${i.datasetId}__${i.id}`,Math.max(0,p.length-1))}const x=s.table("pathProgress"),N=await x.toArray();let P=!1;for(const i of N){const p=`${i.datasetId}__${i.deckId}`,v=g.get(p);typeof v=="number"&&(typeof i.linearOrder=="number"&&i.linearOrder>v&&(i.linearOrder=v,P=!0),typeof i.srsNewOrder=="number"&&i.srsNewOrder>v&&(i.srsNewOrder=v,P=!0))}P&&await x.bulkPut(N)})}}const d=new Lt;function ce(t){return`${t}_${crypto.randomUUID()}`}async function ht(t){const s={id:ce("ds"),name:t?.name?.trim()||"New language",languageTag:t?.languageTag?.trim()||"el-GR",rtlMode:"auto",tokenMode:"target",goalTokens:5e6,createdAt:Date.now(),theme:"paper",ttsRate:1,ttsPitch:1,cjkMode:!1};await d.datasets.add(s),await d.progress.put({datasetId:s.id,lifetimeReps:0,lifetimeTokens:0,currentIndex:0,updatedAt:Date.now()});const a=await He(s.id,"Main");return await Fe(s.id,a.id),await xe(s.id),s}async function He(t,s){const a={id:ce("deck"),datasetId:t,name:s.trim()||"Main",createdAt:Date.now()};return await d.decks.add(a),a}let be=null,lt=new Map;async function Ot(){return be||(be=(async()=>{const t=await d.datasets.toCollection().first();return t||await ht({name:"Sample (Greek)",languageTag:"el-GR"})})(),be)}async function ct(t){const s=lt.get(t);if(s)return s;const a=(async()=>{const l=await d.decks.where("datasetId").equals(t).sortBy("createdAt");if(l.length)return l[0];const r=await He(t,"Main");return await Fe(t,r.id),r})();return lt.set(t,a),a}async function Fe(t,s){const a=[t,s],l=await d.pathProgress.get(a);if(l)return l;const r={datasetId:t,deckId:s,mode:"linear",linearOrder:0,srsNewOrder:0,lifetimeReps:0,lifetimeTokens:0,updatedAt:Date.now()};return await d.pathProgress.put(r),r}async function xe(t){const s=await d.stats.get(t).catch(()=>{});if(s)return s;const a={datasetId:t,uniqueWordsSeen:0,updatedAt:Date.now()};return await d.stats.put(a),a}async function Mt(t,s){const a=Array.from(new Set(s.map(u=>u.trim()).filter(Boolean)));if(a.length===0)return 0;const l=a.map(u=>[t,u]),r=Date.now();return await d.transaction("rw",d.seenWords,d.stats,async()=>{const u=await d.seenWords.bulkGet(l),o=[];for(let N=0;N<a.length;N++)u[N]||o.push({datasetId:t,token:a[N],firstSeenAt:r});const g=await d.stats.get(t).catch(()=>{}),x=g??{datasetId:t,uniqueWordsSeen:0,updatedAt:r};return o.length?(await d.seenWords.bulkPut(o),await d.stats.put({...x,uniqueWordsSeen:(x.uniqueWordsSeen??0)+o.length,updatedAt:r})):g||await d.stats.put(x),o.length})}const Te="https://chatgpt.com/g/g-6958a771444881918c4c59c6b55f33ca-interlinear-studio";function Wt(t){const s=t.toLowerCase().split(".");return s.length>1?s[s.length-1]:""}function Se(t){return t==="two"?"Two columns":t==="threeTranslit"?"Three columns (with transliteration)":t==="threeGloss"?"Three columns (with gloss)":"Four columns"}function Ae(t){return t==="two"?["English","Target"]:t==="threeTranslit"?["English","Target","Transliteration"]:t==="threeGloss"?["English","Target","Gloss"]:["English","Target","Transliteration","Gloss"]}function Bt(t){return`You are preparing a spreadsheet for Sentence Paths.

Return ONLY a table (TSV preferred) with headers:
${Ae(t).join(" | ")}

Rules:
- One sentence per row.
- Keep rows in the order you want to practice (easy → hard).
- You MAY name the Target column like: "Target Language (Greek)" — Sentence Paths auto-detects common variants.
- Gloss should be word-by-word (token-level), not a paragraph.
- No extra commentary before or after the table.`}function Kt(t,s){const a=Ae(t),l=u=>u.join(s),r=t==="two"?["My parents don't know where I am.","…"]:t==="threeTranslit"?["My parents don't know where I am.","…","…"]:t==="threeGloss"?["My parents don't know where I am.","…","my parents / do not / know / where / I am"]:["My parents don't know where I am.","…","…","my parents / do not / know / where / I am"];return l(a)+`
`+l(r)}function dt(t){return[Ae(t),t==="two"?["My parents don't know where I am.","…"]:t==="threeTranslit"?["My parents don't know where I am.","…","…"]:t==="threeGloss"?["My parents don't know where I am.","…","my parents / do not / know / where / I am"]:["My parents don't know where I am.","…","…","my parents / do not / know / where / I am"]]}function We(t,s){const a=URL.createObjectURL(s),l=document.createElement("a");l.href=a,l.download=t,l.click(),setTimeout(()=>URL.revokeObjectURL(a),2e3)}function Ut(t,s){const[a,l]=c.useState(()=>{const r=localStorage.getItem(t);return r==="1"?!0:r==="0"?!1:s});return c.useEffect(()=>{localStorage.setItem(t,a?"1":"0")},[t,a]),[a,l]}function Ht(t){const[s,a]=c.useState(!1),[l,r]=c.useState(0),[u,o]=c.useState("append"),[g,x]=c.useState([]),[N,P]=c.useState(""),[i,p]=Ut("sentencepaths_show_import_tips",!1),[v,k]=c.useState("two"),[S,O]=c.useState("xlsx"),_=f=>t.onToast?t.onToast(f):alert(f);c.useEffect(()=>{t.forceShowTips&&p(!0)},[t.forceShowTips]);const b=c.useRef(null),D=t.fileInputRef??b,y=c.useMemo(()=>({sourceKey:"english",targetKey:"target",translitKey:"transliteration",glossKey:"gloss",tokenKey:"tokencount",idKey:"id"}),[]);async function F(f){a(!0),r(0),x([]),P("");try{const h=Wt(f.name);if(h==="csv"||h==="tsv"){const C=await f.text(),{importCSVorTSV:L}=await $(async()=>{const{importCSVorTSV:B}=await Promise.resolve().then(()=>Be);return{importCSVorTSV:B}},void 0);await L({dataset:t.dataset,deckId:t.deck.id,filename:f.name,text:C,delimiter:h==="tsv"?"	":",",mapping:y,mode:u,onProgress:B=>r(B)}),await t.onImported();return}if(h==="xlsx"){const C=await f.arrayBuffer(),{listSheetNames:L,importXLSX:B}=await $(async()=>{const{listSheetNames:q,importXLSX:Q}=await Promise.resolve().then(()=>Be);return{listSheetNames:q,importXLSX:Q}},void 0),K=await L(C);x(K);const G=K[0]??"";if(P(G),K.length===1&&G){await B({dataset:t.dataset,deckId:t.deck.id,filename:f.name,arrayBuffer:C,sheetName:G,mapping:y,mode:u,onProgress:q=>r(q)}),await t.onImported();return}D.current._sentencepaths_last_xlsx={name:f.name,ab:C};return}_("Unsupported file type. Please import .xlsx, .csv, or .tsv.")}catch(h){_(h?.message||String(h))}finally{a(!1),r(0),D.current&&(D.current.value="")}}async function j(){try{const f=D.current?._sentencepaths_last_xlsx;if(!f){_("Please choose an .xlsx file first.");return}if(!N){_("Please choose a sheet.");return}a(!0),r(0);const{importXLSX:h}=await $(async()=>{const{importXLSX:C}=await Promise.resolve().then(()=>Be);return{importXLSX:C}},void 0);await h({dataset:t.dataset,deckId:t.deck.id,filename:f.name,arrayBuffer:f.ab,sheetName:N,mapping:y,mode:u,onProgress:C=>r(C)}),await t.onImported(),x([]),P(""),D.current._sentencepaths_last_xlsx=void 0}catch(f){_(f?.message||String(f))}finally{a(!1),r(0)}}return e.jsxs("div",{className:"panel",style:{padding:16,marginTop:12},children:[e.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",gap:10,flexWrap:"wrap"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:800,fontSize:16},children:"Import"}),e.jsx("div",{style:{color:"var(--muted)",fontSize:13},children:"xlsx / csv / tsv • auto-detects columns"})]}),e.jsxs("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn "+(u==="append"?"primary":""),onClick:()=>o("append"),disabled:s,title:"Append rows to the end of this path",children:"Append"}),e.jsx("button",{className:"btn "+(u==="replace"?"primary":""),onClick:()=>o("replace"),disabled:s,title:"Replace this path entirely",children:"Replace"}),e.jsx("a",{className:"btn",href:Te,target:"_blank",rel:"noreferrer",title:"Open Interlinear Studio to generate or clean an import sheet",style:{textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center"},children:"Interlinear Studio"})]})]}),e.jsxs("div",{style:{marginTop:10,color:"var(--muted)",fontSize:13,lineHeight:1.5},children:["Want the fastest path? Generate a ready-to-import sheet with ",e.jsx("strong",{children:"Interlinear Studio"}),", then upload it here."]}),t.showPickers!==!1&&e.jsxs("div",{className:"row",style:{gap:10,flexWrap:"wrap",marginTop:12},children:[e.jsx("span",{className:"pill",children:"Language"}),e.jsx("span",{className:"pill strong",children:t.dataset.name}),e.jsx("span",{className:"pill",children:"Path"}),e.jsx("select",{className:"btn",value:t.deck.id,onChange:f=>t.onSelectDeck(f.target.value),style:{minWidth:240},disabled:s,children:t.decks.map(f=>e.jsx("option",{value:f.id,children:f.name},f.id))}),e.jsx("button",{className:"btn",onClick:t.onCreateDeck,disabled:s,title:"Create a new path inside this language",children:"New path"})]}),i&&e.jsxs("div",{className:"panel",style:{padding:12,marginTop:12,background:"rgba(255,255,255,0.45)"},children:[e.jsxs("div",{className:"row",style:{justifyContent:"space-between",gap:10,alignItems:"center"},children:[e.jsx("div",{style:{fontWeight:700},children:"Templates & AI"}),e.jsx("button",{className:"btn",onClick:()=>p(!1),title:"Hide this section",children:"Hide"})]}),e.jsxs("div",{style:{color:"var(--muted)",fontSize:14,marginTop:8,lineHeight:1.55},children:["Pick your column layout, then either download a tiny template or copy an AI prompt.",e.jsx("br",{}),"Minimum: ",e.jsx("strong",{children:"English"})," + ",e.jsx("strong",{children:"Target"}),". Optional: ",e.jsx("strong",{children:"Transliteration"})," and ",e.jsx("strong",{children:"Gloss"})," (word-by-word)."]}),e.jsxs("div",{className:"row",style:{gap:10,flexWrap:"wrap",marginTop:10,alignItems:"center"},children:[e.jsx("span",{className:"pill",children:"Columns"}),e.jsxs("select",{className:"btn",value:v,onChange:f=>k(f.target.value),disabled:s,style:{minWidth:260},title:"Choose the columns you plan to import",children:[e.jsx("option",{value:"two",children:Se("two")}),e.jsx("option",{value:"threeTranslit",children:Se("threeTranslit")}),e.jsx("option",{value:"threeGloss",children:Se("threeGloss")}),e.jsx("option",{value:"four",children:Se("four")})]})]}),e.jsxs("div",{className:"row",style:{gap:10,flexWrap:"wrap",marginTop:10,alignItems:"center"},children:[e.jsx("span",{className:"pill",children:"Format"}),e.jsxs("select",{className:"btn",value:S,onChange:f=>O(f.target.value),disabled:s,style:{minWidth:220},title:"TSV is safest (no commas). XLSX is Excel-friendly.",children:[e.jsx("option",{value:"tsv",children:"TSV (recommended)"}),e.jsx("option",{value:"csv",children:"CSV"}),e.jsx("option",{value:"xlsx",children:"XLSX (Excel)"})]}),e.jsx("span",{className:"pill",title:"Keep rows in the order you want to practice (easy → hard).",children:"Order preserved"})]}),e.jsxs("div",{className:"row",style:{gap:8,flexWrap:"wrap",marginTop:10},children:[e.jsx("a",{className:"btn primary",href:Te,target:"_blank",rel:"noreferrer",style:{textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center"},title:"Generate or clean an import sheet",children:"Open Interlinear Studio"}),e.jsx("button",{className:"btn",onClick:async()=>{try{await navigator.clipboard.writeText(Bt(v)),_("AI prompt copied.")}catch{_("Copy failed.")}},disabled:s,children:"Copy AI prompt"}),e.jsx("button",{className:"btn",onClick:async()=>{try{if(S==="xlsx"){const L=await $(()=>import("./vendor-7461c230.js").then(R=>R.x),[]),B=dt(v),K=L.utils.aoa_to_sheet(B),G=L.utils.book_new();L.utils.book_append_sheet(G,K,"Template");const q=L.write(G,{bookType:"xlsx",type:"array"}),Q=new Blob([q],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});We(`sentencepaths-template-${v}.xlsx`,Q),_("Template downloaded.");return}const h=Kt(v,S==="tsv"?"	":","),C=new Blob([h],{type:"text/plain"});We(`sentencepaths-template-${v}.${S}`,C),_("Template downloaded.")}catch(f){_(f?.message||"Template failed.")}},disabled:s,children:"Download template"})]}),e.jsxs("div",{style:{marginTop:10,padding:10,borderRadius:12,border:"1px solid var(--border)",background:"rgba(255,255,255,0.42)"},children:[e.jsx("div",{style:{fontSize:12,fontWeight:800,letterSpacing:.3,color:"var(--muted)",textTransform:"uppercase"},children:"Headers"}),e.jsx("div",{style:{marginTop:6,fontFamily:"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace",fontSize:13},children:Ae(v).join("  |  ")})]})]}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("input",{ref:D,type:"file",accept:".csv,.tsv,.xlsx",disabled:s,style:{display:"none"},onChange:f=>{const h=f.target.files?.[0];h&&F(h)}}),e.jsxs("button",{className:"dropzone",type:"button",disabled:s,onClick:()=>D.current?.click(),"aria-label":"Choose import file",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[e.jsx("div",{style:{fontWeight:800,fontSize:16},children:"Choose file"}),e.jsx("div",{style:{color:"var(--muted)",fontSize:13},children:"CSV / TSV / XLSX"})]}),e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[e.jsx("span",{className:"pill",children:u==="append"?"Append":"Replace"}),e.jsx("span",{className:"pill",children:"Path order preserved"})]})]})]}),g.length>0&&e.jsxs("div",{className:"panel",style:{padding:12,marginTop:12},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Choose a sheet"}),e.jsxs("div",{className:"row",style:{gap:10,flexWrap:"wrap"},children:[e.jsx("select",{className:"btn",value:N,onChange:f=>P(f.target.value),style:{minWidth:260},children:g.map(f=>e.jsx("option",{value:f,children:f},f))}),e.jsx("button",{className:"btn primary",onClick:j,disabled:s,children:"Import sheet"})]})]}),s&&e.jsxs("div",{style:{marginTop:12},children:[e.jsxs("div",{style:{color:"var(--muted)",fontSize:13,marginBottom:6},children:["Importing… ",Math.round(l*100),"%"]}),e.jsx("div",{className:"progressOuter",style:{width:"100%"},children:e.jsx("div",{className:"progressInner",style:{width:`${Math.round(l*100)}%`}})})]}),!i&&e.jsxs("div",{className:"row",style:{marginTop:10,gap:8,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn",onClick:async()=>{try{const f=await $(()=>import("./vendor-7461c230.js").then(K=>K.x),[]),h=dt(v),C=f.utils.aoa_to_sheet(h),L=f.utils.book_new();f.utils.book_append_sheet(L,C,"Template");const B=f.write(L,{bookType:"xlsx",type:"array"});We(`sentencepaths-template-${v}.xlsx`,new Blob([B],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),_("Template downloaded.")}catch{_("Template failed.")}},children:"Download template"}),e.jsx("button",{className:"btn",onClick:()=>p(!0),children:"Templates & AI"})]})]})}function Ft(t){const{languages:s,currentLanguageId:a,onAddLanguage:l,onRenameLanguage:r,onDeleteLanguage:u}=t,[o,g]=c.useState(""),[x,N]=c.useState(""),[P,i]=c.useState(null),[p,v]=c.useState(""),[k,S]=c.useState(null),[O,_]=c.useState(""),b=()=>{o.trim()&&(l(o.trim(),x.trim()),g(""),N(""))},D=h=>{p.trim()&&(r(h,p.trim()),i(null),v(""))},y=h=>{O&&(u(h,O),S(null),_(""))},F=h=>{i(h.id),v(h.name)},j=h=>{const C=s.find(L=>L.id!==h.id);S(h.id),_(C?.id||"")},f=s.length>1;return e.jsxs("div",{className:"panel",style:{padding:16,marginTop:12},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:10},children:"Languages"}),e.jsx("div",{style:{marginBottom:16},children:s.map(h=>e.jsx("div",{className:"language-item",children:P===h.id?e.jsxs("div",{className:"row",style:{flex:1,gap:8},children:[e.jsx("input",{type:"text",className:"btn",value:p,onChange:C=>v(C.target.value),placeholder:"Language name",style:{flex:1},autoFocus:!0}),e.jsx("button",{className:"btn primary",onClick:()=>D(h.id),children:"Save"}),e.jsx("button",{className:"btn",onClick:()=>i(null),children:"Cancel"})]}):k===h.id?e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{color:"var(--muted)",fontSize:14,marginBottom:8},children:"Move sentences to:"}),e.jsxs("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:[e.jsx("select",{className:"btn",value:O,onChange:C=>_(C.target.value),style:{flex:1,minWidth:150},children:s.filter(C=>C.id!==h.id).map(C=>e.jsx("option",{value:C.id,children:C.name},C.id))}),e.jsx("button",{className:"btn",style:{color:"#c00"},onClick:()=>y(h.id),children:"Delete"}),e.jsx("button",{className:"btn",onClick:()=>S(null),children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("span",{style:{fontWeight:h.id===a?700:400},children:h.name}),h.languageTag&&h.languageTag!=="und"&&e.jsxs("span",{style:{color:"var(--muted)",fontSize:13,marginLeft:8},children:["(",h.languageTag,")"]}),h.id===a&&e.jsx("span",{className:"pill",style:{marginLeft:8,padding:"4px 8px",fontSize:11},children:"current"})]}),e.jsxs("div",{className:"row",style:{gap:6},children:[e.jsx("button",{className:"btn btn-small",onClick:()=>F(h),children:"Rename"}),f&&e.jsx("button",{className:"btn btn-small",onClick:()=>j(h),children:"Delete"})]})]})},h.id))}),e.jsxs("div",{style:{borderTop:"1px solid var(--border)",paddingTop:12},children:[e.jsx("div",{style:{color:"var(--muted)",fontSize:14,marginBottom:8},children:"Add new language"}),e.jsxs("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:[e.jsx("input",{type:"text",className:"btn",value:o,onChange:h=>g(h.target.value),placeholder:"Name (e.g. Greek)",style:{flex:2,minWidth:120}}),e.jsx("input",{type:"text",className:"btn",value:x,onChange:h=>N(h.target.value),placeholder:"Tag (e.g. el-GR)",style:{flex:1,minWidth:80}}),e.jsx("button",{className:"btn primary",onClick:b,disabled:!o.trim(),children:"Add"})]})]})]})}function Gt(t){const s=t.dataset,a=(s.languageTag||"und").toLowerCase(),l=a==="und"?"":a.split("-")[0],r=l?t.voices.filter(o=>(o.lang||"").toLowerCase().startsWith(l)):t.voices,u=r.length?r:t.voices;return e.jsxs("div",{className:"panel",style:{padding:16,marginTop:12},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:10},children:"Settings"}),e.jsxs("div",{className:"row",children:[e.jsx("span",{className:"pill",children:"Theme"}),e.jsxs("select",{className:"btn",value:s.theme==="dark"?"dark":"paper",onChange:o=>t.onUpdate({theme:o.target.value}),children:[e.jsx("option",{value:"paper",children:"Light (glossy)"}),e.jsx("option",{value:"dark",children:"Dark"})]}),e.jsx("span",{className:"pill",children:"Direction"}),e.jsxs("select",{className:"btn",value:s.rtlMode,onChange:o=>t.onUpdate({rtlMode:o.target.value}),children:[e.jsx("option",{value:"auto",children:"Auto"}),e.jsx("option",{value:"ltr",children:"LTR"}),e.jsx("option",{value:"rtl",children:"RTL"})]})]}),e.jsxs("div",{style:{marginTop:8,color:"var(--muted)",fontSize:13,lineHeight:1.45},children:["TTS uses your browser’s built-in voices. Voices for ",e.jsx("strong",{children:s.languageTag||"und"}),": ",r.length,". If you see zero, install a system voice for that language or try another browser/device."]}),e.jsxs("div",{className:"row",style:{marginTop:10,alignItems:"center"},children:[e.jsx("span",{className:"pill",children:"Rate"}),e.jsx("input",{type:"range",min:"0.6",max:"1.4",step:"0.05",value:s.ttsRate,onChange:o=>t.onUpdate({ttsRate:Number(o.target.value)}),style:{flex:1,minWidth:160}}),e.jsx("span",{className:"pill",children:"Pitch"}),e.jsx("input",{type:"range",min:"0.6",max:"1.4",step:"0.05",value:s.ttsPitch,onChange:o=>t.onUpdate({ttsPitch:Number(o.target.value)}),style:{flex:1,minWidth:160}})]}),e.jsxs("div",{className:"row",style:{marginTop:10},children:[e.jsx("span",{className:"pill",children:"Voice"}),e.jsxs("select",{className:"btn",value:s.preferredVoiceURI??"",onChange:o=>t.onUpdate({preferredVoiceURI:o.target.value||void 0}),style:{minWidth:0,flex:1},children:[e.jsx("option",{value:"",children:"Auto"}),u.map(o=>e.jsxs("option",{value:o.voiceURI,children:[o.name," — ",o.lang]},o.voiceURI))]}),e.jsx("button",{className:"btn",type:"button",onClick:t.onTestVoice,disabled:!t.onTestVoice,title:"Play a short test",children:"Test"}),e.jsxs("label",{className:"row",style:{gap:8},children:[e.jsx("input",{type:"checkbox",checked:s.cjkMode,onChange:o=>t.onUpdate({cjkMode:o.target.checked})}),e.jsx("span",{style:{color:"var(--muted)",fontSize:14},children:"CJK token approximation"})]})]})]})}function Vt(){return/iPad|iPhone|iPod/.test(navigator.userAgent)}function qt(){return window.matchMedia("(display-mode: standalone)").matches||navigator.standalone===!0}function zt(){const[t,s]=c.useState(null),[a,l]=c.useState(!1),r=c.useMemo(()=>Vt(),[]),u=c.useMemo(()=>qt(),[]);return c.useEffect(()=>{const o=g=>{g.preventDefault(),s(g),l(!0)};return window.addEventListener("beforeinstallprompt",o),()=>window.removeEventListener("beforeinstallprompt",o)},[]),u?null:e.jsxs("div",{className:"panel",style:{padding:16,marginTop:12},children:[e.jsxs("div",{className:"row",style:{justifyContent:"space-between"},children:[e.jsxs("div",{style:{maxWidth:700},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:4},children:"Install Sentence Paths"}),e.jsx("div",{style:{color:"var(--muted)",fontSize:14},children:"Works offline after the first load. Install it like an app for faster access."})]}),!r&&t&&e.jsx("button",{className:"btn primary",onClick:async()=>{try{await t.prompt(),l(!1)}catch{l(!1)}},children:"Install"})]}),r&&e.jsxs("div",{style:{marginTop:12,color:"var(--muted)",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"iOS Safari:"})," tap ",e.jsx("span",{className:"kbd",children:"Share"})," →"," ",e.jsx("span",{className:"kbd",children:"Add to Home Screen"}),"."]}),e.jsx("div",{style:{marginTop:6},children:"After installing, open from your home screen for the best experience."})]}),!r&&!t&&a===!1&&e.jsx("div",{style:{marginTop:12,color:"var(--muted)",fontSize:14},children:"If you do not see an install button, your browser may not support PWA install for this build."})]})}function Xt(t){const{row:s}=t,a=t.rtl?"rtl":"ltr";return s?e.jsx("div",{className:"panel sentenceCard",style:{padding:18,marginTop:18,"--sp-source":`${16*t.fontScale}px`,"--sp-target":`${26*t.fontScale}px`},dir:a,children:e.jsxs("div",{className:"sentenceGrid",children:[t.showSource?e.jsx("div",{className:"sentenceCol",children:e.jsx("div",{className:"sentenceSource",children:s.sourceText||"—"})}):null,e.jsxs("div",{className:"sentenceCol",children:[e.jsx("div",{className:"sentenceTarget",children:s.targetText||"—"}),t.showTranslit?e.jsx("div",{className:"sentenceMeta",children:e.jsx("div",{className:"sentenceMetaText",children:s.transliterationText||"—"})}):null,t.showGloss?e.jsx("div",{className:"sentenceMeta",children:e.jsx("div",{className:"sentenceMetaText",style:{whiteSpace:"pre-wrap"},children:s.glossText||"—"})}):null]})]})}):e.jsxs("div",{className:"panel",style:{padding:18,marginTop:18},children:[e.jsx("div",{style:{fontWeight:900,fontSize:18,marginBottom:6},children:"No sentences yet"}),e.jsxs("div",{style:{color:"var(--muted)",lineHeight:1.5},children:["Import a spreadsheet with at least two columns: ",e.jsx("strong",{children:"English"})," and ",e.jsx("strong",{children:"Target"}),".",e.jsx("br",{}),"(Optional: Transliteration, Gloss.)"]})]})}function Ne(t){const s=c.useRef(null);return c.useEffect(()=>{if(!t.open)return;const a=l=>{l.key==="Escape"&&t.onClose()};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[t.open,t.onClose]),t.open?e.jsx("div",{className:"modalOverlay",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"modalCard",ref:s,children:[e.jsxs("div",{className:"modalHeader",children:[e.jsx("div",{style:{fontWeight:900},children:t.title??""}),e.jsx("button",{className:"iconBtn",onClick:t.onClose,"aria-label":"Close",children:"✕"})]}),e.jsx("div",{className:"modalBody",children:t.children})]})}):null}function $t(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}function Jt(){const t=typeof window<"u"&&"speechSynthesis"in window&&typeof SpeechSynthesisUtterance<"u",s=$t(),[a,l]=c.useState([]),[r,u]=c.useState(!s),o=c.useRef("");c.useEffect(()=>{if(!t)return;const p=()=>l(window.speechSynthesis.getVoices());return p(),window.speechSynthesis.onvoiceschanged=p,()=>{window.speechSynthesis.onvoiceschanged=null}},[t]);const g=c.useCallback(()=>{if(t)try{const p=new SpeechSynthesisUtterance(" ");p.volume=0,window.speechSynthesis.cancel(),window.speechSynthesis.speak(p),u(!0)}catch{u(!0)}},[t]),x=c.useCallback(p=>{if(!a.length)return;if(p.voiceURI){const k=a.find(S=>S.voiceURI===p.voiceURI);if(k)return k}return a.filter(k=>(k.lang||"").toLowerCase().startsWith(p.lang.toLowerCase()))[0]??a[0]},[a]),N=c.useCallback((p,v)=>{if(o.current=p,!t||!p.trim()||s&&!r)return;try{window.speechSynthesis.resume?.()}catch{}window.speechSynthesis.cancel();const k=new SpeechSynthesisUtterance(p);k.lang=v.lang,k.rate=v.rate,k.pitch=v.pitch;const S=x(v);S&&(k.voice=S),o.current===p&&window.speechSynthesis.speak(k)},[x,r,s,t]),P=c.useCallback((p,v)=>(o.current=p,new Promise(k=>{if(!t||!p.trim()||s&&!r)return k();try{window.speechSynthesis.resume?.()}catch{}window.speechSynthesis.cancel();const S=new SpeechSynthesisUtterance(p);S.lang=v.lang,S.rate=v.rate,S.pitch=v.pitch;const O=x(v);if(O&&(S.voice=O),o.current!==p)return k();const b=Math.max(6e3,Math.min(45e3,Math.ceil(p.length*160))),D=window.setTimeout(()=>k(),b);S.onend=()=>{window.clearTimeout(D),k()},S.onerror=()=>{window.clearTimeout(D),k()},window.speechSynthesis.speak(S)})),[x,r,s,t]),i=c.useCallback(()=>{if(t)try{window.speechSynthesis.cancel()}catch{}},[t]);return{voices:a,unlocked:r,supported:t,prime:g,speak:N,speakAsync:P,stop:i,isIOS:s}}function Yt(t={}){const{immediate:s=!1,onNeedRefresh:a,onOfflineReady:l,onRegistered:r,onRegisteredSW:u,onRegisterError:o}=t;let g,x;const N=async(i=!0)=>{await x};async function P(){if("serviceWorker"in navigator){if(g=await $(async()=>{const{Workbox:i}=await import("./vendor-7461c230.js").then(p=>p.w);return{Workbox:i}},[]).then(({Workbox:i})=>new i("/sw.js",{scope:"/",type:"classic"})).catch(i=>{o?.(i)}),!g)return;g.addEventListener("activated",i=>{(i.isUpdate||i.isExternal)&&window.location.reload()}),g.addEventListener("installed",i=>{i.isUpdate||l?.()}),g.register({immediate:s}).then(i=>{u?u("/sw.js",i):r?.(i)}).catch(i=>{o?.(i)})}}return x=P(),N}async function mt(){return await $(()=>import("./vendor-7461c230.js").then(t=>t.x),[])}function W(t){return t.trim().toLowerCase()}function Qt(t,s){const a=t.split(/\r?\n/).filter(o=>o.trim().length>0);if(a.length===0)return{headers:[],rows:[],hasHeader:!1};const l=a[0].split(s).map(o=>o.trim()),r=l.map(W);const u=r.some(h=>/^(english|source|prompt|question|input)$/.test(h)||/^(target|answer|response)$/.test(h)||/translit/.test(h)||/gloss/.test(h)||/token/.test(h)||/\bid\b/.test(h)||/target\s*language/.test(h)||/source\s*language/.test(h));const o=u&&r.every(h=>h.length<=60);if(o){const g=r,x=a.slice(1).map(h=>{const C=h.split(s),L={};return g.forEach((B,K)=>L[B]=(C[K]??"").trim()),L});return{headers:g,rows:x,hasHeader:!0}}let g=0;for(let x=0;x<Math.min(50,a.length);x++)g=Math.max(g,a[x].split(s).length);g=Math.max(2,Math.min(10,g));const x=[];for(let h=0;h<g;h++)x.push("col"+h);const N=a.map(h=>{const C=h.split(s),L={};return x.forEach((B,K)=>L[B]=(C[K]??"").trim()),L});return{headers:x,rows:N,hasHeader:!1}}function X(t,s,a){const l=new Set(t.map(W)),r=W(s);if(l.has(r))return r;for(const u of a?.equalsAny??[]){const o=W(u);if(l.has(o))return o}for(const u of t){const o=W(u),g=a?.containsAny??[];if(g.length&&g.every(x=>o.includes(W(x))))return o}for(const u of t){const o=W(u),g=a?.containsAny??[];if(g.length&&g.some(x=>o.includes(W(x))))return o}}function Ge(t,s){const a=t.map(W),l=X(a,s.sourceKey,{equalsAny:["english","en","source","source text","source sentence","prompt"],containsAny:["english"]})??W(s.sourceKey),r=X(a,s.targetKey,{equalsAny:["target","target text","target sentence","answer","response"],containsAny:["target"]})??W(s.targetKey),u=s.translitKey?X(a,s.translitKey,{equalsAny:["transliteration","translit","romanization","romaji","pinyin"],containsAny:["translit"]}):X(a,"transliteration",{equalsAny:["transliteration","translit","romanization","romaji","pinyin"],containsAny:["translit"]}),o=s.glossKey?X(a,s.glossKey,{equalsAny:["gloss","word-by-word gloss","word by word gloss","wbg"],containsAny:["gloss","word-by-word","word by word"]}):X(a,"gloss",{equalsAny:["gloss","word-by-word gloss","word by word gloss","wbg"],containsAny:["gloss","word-by-word","word by word"]}),g=s.tokenKey?X(a,s.tokenKey,{equalsAny:["tokencount","token count"],containsAny:["token"]}):X(a,"tokencount",{equalsAny:["tokencount","token count"],containsAny:["token"]}),x=s.idKey?X(a,s.idKey,{equalsAny:["id","uuid"],containsAny:["id"]}):X(a,"id",{equalsAny:["id","uuid"],containsAny:["id"]});return{sourceKey:l,targetKey:r,translitKey:u,glossKey:o,tokenKey:g,idKey:x}}function V(t,s){if(!s)return"";const a=W(s);return String(t[a]??t[s]??"").trim()}async function Ce(t,s){await d.sentences.where("[datasetId+deckId]").equals([t,s]).delete(),await d.srs.where("[datasetId+deckId+dueAt]").between([t,s,0],[t,s,Number.MAX_SAFE_INTEGER]).delete(),await d.imports.where("[datasetId+deckId+createdAt]").between([t,s,0],[t,s,Number.MAX_SAFE_INTEGER]).delete();const a=await d.pathProgress.get([t,s]).catch(()=>{});a&&await d.pathProgress.put({...a,linearOrder:0,srsNewOrder:0,updatedAt:Date.now()})}async function Zt(t,s){const a=await d.sentences.where("[datasetId+deckId]").equals([t,s]).toArray();a.sort((o,g)=>(o.order??0)-(g.order??0)||String(o.id).localeCompare(String(g.id)));let l=!1;a.forEach((o,g)=>{o.order!==g&&(o.order=g,l=!0)}),l&&a.length&&await d.sentences.bulkPut(a);const r=Math.max(0,a.length-1),u=await d.pathProgress.get([t,s]).catch(()=>{});if(u){const o={...u,linearOrder:a.length?Math.min(u.linearOrder??0,r):0,srsNewOrder:a.length?Math.min(u.srsNewOrder??0,r):0,updatedAt:Date.now()};await d.pathProgress.put(o)}}async function Ke(t){const{datasetId:s,deckId:a,importId:l}=t;return await d.transaction("rw",d.sentences,d.imports,d.srs,d.pathProgress,async()=>{const u=(await d.sentences.where("[datasetId+deckId+importId]").equals([s,a,l]).toArray()).map(o=>o.id);if(u.length){await d.sentences.bulkDelete(u);const o=u.map(g=>[s,a,g]);await d.srs.bulkDelete(o)}return await d.imports.delete(l),await Zt(s,a),{deleted:u.length}})}async function pt(t,s){const a=await d.sentences.where("[datasetId+deckId+order]").between([t,s,0],[t,s,Number.MAX_SAFE_INTEGER]).last();return a?(a.order??0)+1:0}async function es(t){const{dataset:s,deckId:a,filename:l,text:r,delimiter:u,mapping:o,mode:g,onProgress:x}=t,N=Qt(r,u),P=N.headers;let i=Ge(P,o),p=P.includes(W(i.sourceKey)),v=P.includes(W(i.targetKey));if(!p||!v){if(P.length>=2){i={...i,sourceKey:P[0],targetKey:P[1],translitKey:P[2]||i.translitKey,glossKey:P[3]||i.glossKey};p=!0;v=!0}else throw new Error(`Missing required columns. Found headers: ${P.join(", ")}.

Expected at least English + Target (or a header containing "target", like "Target Language (Greek)").`)}const k=N.rows,S=1500;return await d.transaction("rw",d.sentences,d.imports,d.srs,d.pathProgress,async()=>{g==="replace"&&await Ce(s.id,a);const O=g==="replace"?0:await pt(s.id,a),_=ce("imp"),b=Date.now(),D=[];let y=0;for(let j=0;j<k.length;j++){const f=k[j],h=V(f,i.sourceKey),C=V(f,i.targetKey);if(!h&&!C)continue;const L=V(f,i.tokenKey),B=L?Math.max(0,Number(L)||0):Ie(C,s.cjkMode),K=V(f,i.idKey),G=K||ce("s");D.push({id:G,datasetId:s.id,deckId:a,order:O+y,importId:_,sourceText:h,targetText:C,transliterationText:V(f,i.translitKey)||void 0,glossText:V(f,i.glossKey)||void 0,tokenCount:B}),y++,D.length>=S&&(await d.sentences.bulkPut(D),D.length=0,x?.(j/k.length),await Ue.waitFor(new Promise(q=>setTimeout(q,0))))}D.length&&await d.sentences.bulkPut(D);const F={id:_,datasetId:s.id,deckId:a,filename:l,createdAt:b,mode:g,startOrder:O,endOrder:Math.max(O-1,O+y-1),rowCount:y};return await d.imports.add(F),x?.(1),{imported:y,headers:P,resolved:i}})}async function ts(t){const{dataset:s,deckId:a,filename:l,arrayBuffer:r,sheetName:u,mapping:o,mode:g,onProgress:x}=t,N=await mt(),P=N.read(r,{type:"array"}),i=P.Sheets[u];if(!i)throw new Error("Sheet not found.");const v=N.utils.sheet_to_json(i,{defval:""}).map(D=>{const y={};for(const[F,j]of Object.entries(D))y[W(F)]=j;return y}),k=Object.keys(v[0]??{}).map(W),S=Ge(k,o),O=k.includes(W(S.sourceKey)),_=k.includes(W(S.targetKey));if(!O||!_)throw new Error(`Missing required columns in sheet "${u}". Found headers: ${k.join(", ")}.

Expected at least English + Target (or a header containing "target", like "Target Language (Greek)").`);const b=1500;return await d.transaction("rw",d.sentences,d.imports,d.srs,d.pathProgress,async()=>{g==="replace"&&await Ce(s.id,a);const D=g==="replace"?0:await pt(s.id,a),y=ce("imp"),F=Date.now(),j=[];let f=0;for(let C=0;C<v.length;C++){const L=v[C],B=V(L,S.sourceKey),K=V(L,S.targetKey);if(!B&&!K)continue;const G=V(L,S.tokenKey),q=G?Math.max(0,Number(G)||0):Ie(K,s.cjkMode),Q=V(L,S.idKey),R=Q||ce("s");j.push({id:R,datasetId:s.id,deckId:a,order:D+f,importId:y,sourceText:B,targetText:K,transliterationText:V(L,S.translitKey)||void 0,glossText:V(L,S.glossKey)||void 0,tokenCount:q}),f++,j.length>=b&&(await d.sentences.bulkPut(j),j.length=0,x?.(C/Math.max(1,v.length)),await Ue.waitFor(new Promise(z=>setTimeout(z,0))))}j.length&&await d.sentences.bulkPut(j);const h={id:y,datasetId:s.id,deckId:a,filename:l,createdAt:F,mode:g,startOrder:D,endOrder:Math.max(D-1,D+f-1),rowCount:f};return await d.imports.add(h),x?.(1),{sheets:P.SheetNames,imported:f,headers:k,resolved:S}})}async function ss(t){return(await mt()).read(t,{type:"array"}).SheetNames}const Be=Object.freeze(Object.defineProperty({__proto__:null,clearPathData:Ce,deleteImportBatch:Ke,importCSVorTSV:es,importXLSX:ts,inferMappingFromHeaders:Ge,listSheetNames:ss},Symbol.toStringTag,{value:"Module"}));function re(t,s,a){return Math.max(s,Math.min(a,t))}function ns(t){return/[\u0590-\u05FF\u0600-\u06FF]/.test(t)}function ut(t){return new Promise(s=>setTimeout(s,t))}function as(t,s){return s==="again"?{ease:re(t-.2,1.3,2.8),mult:0,minDays:0}:s==="hard"?{ease:re(t-.05,1.3,2.8),mult:1,minDays:1}:s==="good"?{ease:re(t+0,1.3,2.8),mult:1.8,minDays:1}:{ease:re(t+.1,1.3,2.8),mult:2.2,minDays:1}}function rs(t,s){const a=as(t.ease,s),l=s==="again"?0:t.reps+1;let r=0;return s==="again"?r=0:t.reps===0?r=Math.max(1,a.minDays):t.reps===1?r=Math.max(3,a.minDays):r=Math.max(Math.round(t.intervalDays*a.ease*a.mult),a.minDays),{reps:l,intervalDays:r,ease:a.ease}}function is(t,s,a){const l=new Blob([s],{type:a}),r=URL.createObjectURL(l),u=document.createElement("a");u.href=r,u.download=t,document.body.appendChild(u),u.click(),u.remove(),setTimeout(()=>URL.revokeObjectURL(r),2500)}function os(){const t=Jt(),[s,a]=c.useState(null),l=n=>{a({msg:n,ts:Date.now()}),setTimeout(()=>a(m=>m&&Date.now()-m.ts>1800?null:m),2e3)},[r,u]=c.useState("home"),o=c.useRef("home"),g=()=>{he(!1),me(!1),pe(!1),Z(!1),o.current="home",u("home")},x=()=>{r!=="library"&&(o.current=r),u("library")},N=()=>{u(o.current||"home")},[P,i]=c.useState(!1),p=c.useRef(null);c.useEffect(()=>{try{const n=Yt({immediate:!0,onNeedRefresh(){i(!0)},onOfflineReady(){}});p.current=n}catch{}},[]);async function v(){try{if(p.current){await p.current(!0);return}}catch{}try{if("serviceWorker"in navigator){const n=await navigator.serviceWorker.getRegistrations();for(const m of n)await m.unregister()}}catch{}try{if("caches"in window){const n=await caches.keys();await Promise.all(n.map(m=>caches.delete(m)))}}catch{}location.reload()}const[k,S]=c.useState([]),[O,_]=c.useState([]),[b,D]=c.useState(""),[y,F]=c.useState(""),j=c.useMemo(()=>k.find(n=>n.id===b)??null,[k,b]),f=c.useMemo(()=>O.find(n=>n.id===y)??null,[O,y]),[h,C]=c.useState(null),[L,B]=c.useState(0),[K,G]=c.useState(0),[q,Q]=c.useState(0),[R,z]=c.useState(null),[gt,se]=c.useState(null),[ve,Ve]=c.useState(()=>localStorage.getItem("sentencepaths_showSource")!=="0"),[de,qe]=c.useState(()=>localStorage.getItem("sentencepaths_showTranslit")==="1"),[ue,ze]=c.useState(()=>localStorage.getItem("sentencepaths_showGloss")==="1"),[Pe,ls]=c.useState(()=>{const n=localStorage.getItem("sentencepaths_fontScale");return n?re(parseFloat(n),.8,1.4):1}),[De,he]=c.useState(!1),[Re,me]=c.useState(!1),[Ee,pe]=c.useState(!1),[Xe,ft]=c.useState(!1),[je,wt]=c.useState([]),[yt,ge]=c.useState(!1),[_e,Z]=c.useState(!1),[$e,Je]=c.useState(""),[Ye,Qe]=c.useState(""),[Ze,xt]=c.useState(!1),[U,Le]=c.useState(()=>localStorage.getItem("sentencepaths_autoRun")==="1"),[ie,ee]=c.useState(!1),[oe,et]=c.useState(localStorage.getItem("sentencepaths_autoAfter")==="delay"?"delay":"audio"),[fe,vt]=c.useState(()=>{const n=localStorage.getItem("sentencepaths_autoDelaySec");return n?re(parseFloat(n),0,10):.5}),[we,jt]=c.useState(()=>localStorage.getItem("sentencepaths_ttsEnglish")==="1");c.useEffect(()=>{localStorage.setItem("sentencepaths_showSource",ve?"1":"0")},[ve]),c.useEffect(()=>{localStorage.setItem("sentencepaths_showTranslit",de?"1":"0")},[de]),c.useEffect(()=>{localStorage.setItem("sentencepaths_showGloss",ue?"1":"0")},[ue]),c.useEffect(()=>{localStorage.setItem("sentencepaths_fontScale",String(Pe))},[Pe]),c.useEffect(()=>{localStorage.setItem("sentencepaths_autoRun",U?"1":"0")},[U]),c.useEffect(()=>{U||ee(!1)},[U]),c.useEffect(()=>{r!=="practice"&&ee(!1)},[r]),c.useEffect(()=>{localStorage.setItem("sentencepaths_autoAfter",oe)},[oe]),c.useEffect(()=>{localStorage.setItem("sentencepaths_autoDelaySec",String(fe))},[fe]),c.useEffect(()=>{localStorage.setItem("sentencepaths_ttsEnglish",we?"1":"0")},[we]);const kt=c.useMemo(()=>j?j.rtlMode==="rtl"?!0:j.rtlMode==="ltr"?!1:R?.targetText?ns(R.targetText):!1:!1,[j,R]);async function tt(){const n=await Ot(),m=await ct(n.id),{seedSampleIfEmpty:T}=await $(async()=>{const{seedSampleIfEmpty:ae}=await import("./sample-5ee62926.js");return{seedSampleIfEmpty:ae}},__vite__mapDeps([0,1,2,3]));await T(n,m),await xe(n.id);const w=await d.datasets.orderBy("createdAt").toArray(),I=localStorage.getItem("sentencepaths_currentDataset")??n.id,A=w.find(ae=>ae.id===I)?.id??n.id,M=await d.decks.where("datasetId").equals(A).sortBy("createdAt"),E=localStorage.getItem("sentencepaths_currentDeck")??M[0]?.id??m.id,H=M.find(ae=>ae.id===E)?.id??M[0]?.id??m.id;S(w),_(M),D(A),F(H)}async function st(n,m){const T=await ht({name:n,languageTag:m||"und"}),w=await ct(T.id);await xe(T.id);const I=await d.datasets.orderBy("createdAt").toArray();S(I),D(T.id),F(w.id),o.current="home",x(),ge(!0),l("Language added")}c.useEffect(()=>{tt().catch(n=>console.error(n))},[]),c.useEffect(()=>{const n=j?.theme==="dark"?"dark":"paper";document.documentElement.setAttribute("data-theme",n)},[j?.theme]),c.useEffect(()=>{b&&(async()=>{const n=await d.decks.where("datasetId").equals(b).sortBy("createdAt");_(n);const m=n[0]?.id??"";(!y||!n.some(T=>T.id===y))&&F(m),localStorage.setItem("sentencepaths_currentDataset",b)})().catch(n=>console.error(n))},[b]),c.useEffect(()=>{y&&localStorage.setItem("sentencepaths_currentDeck",y)},[y]);async function J(){if(!b||!y)return;const n=await d.pathProgress.get([b,y]);n&&C(n);const m=await xe(b);B(m.uniqueWordsSeen??0);const T=await d.sentences.where("[datasetId+deckId]").equals([b,y]).count();G(T);const w=Date.now(),I=await d.srs.where("[datasetId+deckId+dueAt]").between([b,y,0],[b,y,w],!0,!0).count();Q(I);const A=await d.imports.where("[datasetId+deckId+createdAt]").between([b,y,0],[b,y,Number.MAX_SAFE_INTEGER]).toArray();A.sort((M,E)=>(E.createdAt??0)-(M.createdAt??0)),wt(A)}async function te(){if(!b||!y)return;const n=await d.pathProgress.get([b,y])??null;if(!n){z(null),se(null);return}if(n.mode==="linear"){const E=await d.sentences.where("[datasetId+deckId+order]").equals([b,y,n.linearOrder]).first()??null;if(E){z(E),se(null);return}const H=d.sentences.where("[datasetId+deckId+order]").between([b,y,0],[b,y,Number.MAX_SAFE_INTEGER],!0,!0),ae=await H.first()??null,Oe=await H.last()??null,Me=Oe&&n.linearOrder>(Oe.order??0)?Oe:ae;if(Me){const it={...n,linearOrder:Me.order??0,updatedAt:Date.now()};await d.pathProgress.put(it),C(it),z(Me)}else z(null);se(null);return}const m=Date.now(),T=await d.srs.where("[datasetId+deckId+dueAt]").between([b,y,0],[b,y,m],!0,!0).sortBy("dueAt")??[];if(T.length){const E=T[0],H=await d.sentences.get(E.sentenceId)??null;z(H),se(E);return}const w=await d.sentences.where("[datasetId+deckId+order]").equals([b,y,n.srsNewOrder]).first()??null;if(!w){z(null),se(null);return}const I=[b,y,w.id],A=await d.srs.get(I)??null,M=A??{datasetId:b,deckId:y,sentenceId:w.id,dueAt:m,reps:0,ease:2.2,intervalDays:0,lastReviewedAt:0,createdAt:m};A||await d.srs.put(M),z(w),se(M)}c.useEffect(()=>{!b||!y||(J().catch(()=>null),te().catch(()=>null))},[b,y]),c.useEffect(()=>{h&&(te().catch(()=>null),J().catch(()=>null))},[h?.mode,h?.linearOrder,h?.srsNewOrder]);async function nt(n){if(!j)return n.tokenCount??0;const m=n,T=m.target??m.Target??m.answer??m.response,w=m.english??m.English??m.source??m.prompt,I=(n.targetText||T||"").trim(),A=(n.sourceText||w||"").trim(),M=Ie(I,j.cjkMode);if(!(I&&n.targetText!==I||A&&n.sourceText!==A||typeof n.tokenCount!="number"||n.tokenCount!==M))return n.tokenCount??M;const H={...n,targetText:I,sourceText:A,tokenCount:M};return await d.sentences.put(H),R?.id===H.id&&z(H),H.tokenCount??M}async function at(n){if(!j)return;const m=n,T=(n.targetText||m.target||m.Target||"").toString(),w=_t(T,j.cjkMode);if(!w.length)return;if(await Mt(j.id,w)>0){const A=await xe(j.id);B(A.uniqueWordsSeen??0)}}async function le(n,m){if(!b||!y||!h)return;const T=R,w=m&&T?await nt(T):0,I=h.linearOrder,A=Math.max(0,I+n),M=await d.sentences.where("[datasetId+deckId+order]").equals([b,y,A]).first()??null;if(!M){l("End of path");return}const E={...h,linearOrder:A,srsNewOrder:Math.max(h.srsNewOrder,A),lifetimeReps:h.lifetimeReps+(m?1:0),lifetimeTokens:h.lifetimeTokens+(m?w:0),updatedAt:Date.now()};await d.pathProgress.put(E),C(E),z(M),se(null),m&&T&&(await at(T),await J())}async function Y(n){if(!b||!y||!h||!R)return;const m=await nt(R),T=Date.now(),w=gt;R.id;const I=w??{datasetId:b,deckId:y,sentenceId:R.id,dueAt:T,reps:0,ease:2.2,intervalDays:0,lastReviewedAt:0,createdAt:T},A=rs({reps:I.reps,intervalDays:I.intervalDays,ease:I.ease},n),M=T+A.intervalDays*24*60*60*1e3,E={...I,reps:A.reps,intervalDays:A.intervalDays,ease:A.ease,dueAt:M,lastReviewedAt:T};await d.srs.put(E);const H={...h,lifetimeReps:h.lifetimeReps+1,lifetimeTokens:h.lifetimeTokens+m,srsNewOrder:w?h.srsNewOrder:h.srsNewOrder+1,updatedAt:T};await d.pathProgress.put(H),C(H),await at(R),await J(),await te()}async function ke(n){if(!b||!y||!h)return;const m={...h,mode:n,updatedAt:Date.now()};await d.pathProgress.put(m),C(m),n==="srs"&&Le(!1)}async function ne(){if(!j||!R)return;if(!t.supported){l("Text-to-speech isn't available in this browser");return}if(t.isIOS&&!t.unlocked){t.prime(),l("Tap again to play audio");return}const n=R.targetText||"",m=R.sourceText||"";we&&m.trim()&&await t.speakAsync(m,{lang:"en-US",rate:1,pitch:1}),await t.speakAsync(n,{lang:j.languageTag||"und",rate:j.ttsRate??1,pitch:j.ttsPitch??1,voiceURI:j.preferredVoiceURI})}c.useEffect(()=>{if(r!=="practice")return;const n=w=>{const I=w;if(!I)return!1;const A=(I.tagName||"").toLowerCase();return A==="input"||A==="textarea"||A==="select"||I.isContentEditable},m=()=>{pe(!1),he(!1),me(!1),Z(!1)},T=w=>{if(w.repeat||n(w.target))return;const I=w.key,A=I.toLowerCase();if(Ee||De||Re||_e){I==="Escape"&&(w.preventDefault(),m());return}if(I==="?"){w.preventDefault(),pe(E=>!E);return}if(A==="h"){w.preventDefault(),he(!0);return}if(A==="s"){w.preventDefault(),me(!0);return}if(A==="l"){w.preventDefault(),x();return}if(I==="Escape"){w.preventDefault(),u("home");return}if(r==="library"){if(A==="n"){w.preventDefault(),Z(!0);return}if(I==="Backspace"){w.preventDefault(),N();return}}if(h){if(A==="m"){w.preventDefault(),ke(h.mode==="srs"?"linear":"srs");return}if(A==="p"){w.preventDefault(),ne();return}if(h.mode==="linear"){if(w.code==="Space"||I===" "){w.preventDefault(),U?ee(E=>!E):ne();return}if(A==="a"){w.preventDefault(),Le(E=>{const H=!E;return H&&ee(!1),H});return}if(A==="e"){w.preventDefault(),Ve(E=>!E);return}if(A==="t"){w.preventDefault(),qe(E=>!E);return}if(A==="g"){w.preventDefault(),ze(E=>!E);return}if(A==="c"){w.preventDefault(),R?.targetText&&navigator.clipboard.writeText(R.targetText).then(()=>l("Copied"));return}if(I==="ArrowRight"){w.preventDefault(),U&&ee(!0),le(1,!0);return}if(I==="ArrowLeft"){w.preventDefault(),U&&ee(!0),le(-1,!0);return}return}if(h.mode==="srs"){if(I==="1"){w.preventDefault(),Y("again");return}if(I==="2"){w.preventDefault(),Y("hard");return}if(I==="3"){w.preventDefault(),Y("good");return}if(I==="4"){w.preventDefault(),Y("easy");return}}}};return window.addEventListener("keydown",T,{passive:!1}),()=>window.removeEventListener("keydown",T)},[r,Ee,De,Re,_e,h,U,R?.targetText,ne,le,ke,Y]);const ye=c.useRef(0);c.useEffect(()=>{if(!U||ie||r!=="practice"||!h||h.mode!=="linear"||!R)return;const n=++ye.current;return(async()=>(await ut(120),ye.current===n&&(await ne(),ye.current===n&&(oe==="delay"&&await ut(fe*1e3),ye.current===n&&await le(1,!0)))))(),()=>{ye.current++}},[U,ie,r,h?.mode,R?.id,oe,fe]);const bt=h?.lifetimeReps??0,St=h?.lifetimeTokens??0,rt=j?.name??"",Nt=!!R?.transliterationText?.trim(),Tt=!!R?.glossText?.trim(),It=h?.mode==="srs"?"Review":"Read";return e.jsxs("div",{className:"container",children:[e.jsxs("header",{className:"topbar",children:[e.jsxs("button",{type:"button",className:"brandRow brandBtn",onClick:g,title:"Home",children:[e.jsx("div",{className:"logoDot","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("div",{className:"brandTitle",children:"Sentence Paths"}),e.jsx("div",{className:"brandSub",children:"Bilingual sentences • local-first • TTS"})]})]}),e.jsxs("div",{className:"topbarCenter",children:[e.jsx("button",{className:"pill strong",onClick:x,title:"Library & import",children:rt?`${rt} · Library`:"Library & Import"}),e.jsx("span",{className:"pill",children:It})]}),e.jsxs("div",{className:"topbarRight",children:[e.jsxs("span",{className:"statChip",title:"Total repetitions",children:["Reps ",e.jsx("strong",{children:bt})]}),e.jsxs("span",{className:"statChip",title:"Total target tokens read",children:["Words read ",e.jsx("strong",{children:St})]}),e.jsx("button",{className:"iconBtn",onClick:()=>he(!0),title:"Help / setup",children:"?"}),e.jsx("button",{className:"iconBtn",onClick:()=>me(!0),title:"Settings",children:"⚙"})]})]}),P?e.jsxs("div",{className:"updateBanner",role:"status",children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("strong",{children:"Update available."})," Refresh to load the latest version (your local data stays intact)."]}),e.jsx("button",{className:"btn btn-small",onClick:()=>{v()},children:"Refresh"}),e.jsx("button",{className:"btn btn-small",onClick:()=>i(!1),"aria-label":"Dismiss",children:"Later"})]}):null,r==="home"?e.jsxs("div",{style:{marginTop:20},children:[e.jsxs("div",{className:"panel",style:{padding:20},children:[e.jsx("div",{style:{fontWeight:900,fontSize:22,letterSpacing:.2},children:"Start a session"}),e.jsx("div",{style:{color:"var(--muted)",marginTop:6,lineHeight:1.5},children:"Read sentences like a book — with automatic audio."}),e.jsxs("div",{className:"segmented",style:{marginTop:16},children:[e.jsx("button",{className:"segBtn "+(h?.mode!=="srs"?"active":""),onClick:()=>ke("linear"),children:"Read"}),e.jsx("button",{className:"segBtn "+(h?.mode==="srs"?"active":""),onClick:()=>ke("srs"),children:"Review"})]}),e.jsxs("div",{className:"row",style:{marginTop:18,gap:12,flexWrap:"wrap"},children:[K===0?e.jsx("button",{className:"btn primary heroBtn",onClick:()=>{ge(!0),x()},children:"Add sentences"}):e.jsx("button",{className:"btn primary heroBtn",onClick:()=>u("practice"),children:"Start practice"}),e.jsx("button",{className:"btn",onClick:()=>Z(!0),children:"Add language"}),e.jsx("button",{className:"btn",onClick:()=>{ge(!1),x()},children:"Library & Import"})]}),e.jsxs("div",{style:{marginTop:14,color:"var(--muted)",fontSize:13},children:["Current library: ",e.jsx("strong",{children:K})," sentences • Due: ",e.jsx("strong",{children:q})]})]}),e.jsx("div",{className:"panel",style:{padding:16,marginTop:12},children:e.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",gap:12,flexWrap:"wrap"},children:[e.jsxs("div",{style:{minWidth:240},children:[e.jsx("div",{style:{fontWeight:900,fontSize:16},children:"Interlinear Studio"}),e.jsx("div",{style:{color:"var(--muted)",fontSize:13,lineHeight:1.5,marginTop:6},children:"Generate or clean an import sheet (XLSX / CSV / TSV) in the exact format Sentence Paths expects."})]}),e.jsx("a",{className:"btn primary",href:Te,target:"_blank",rel:"noreferrer",style:{textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center"},children:"Open Interlinear Studio"})]})})]}):null,r==="practice"?e.jsxs("div",{style:{marginTop:6},children:[e.jsx(Xt,{row:R,showSource:ve,showTranslit:de,showGloss:ue,rtl:kt,fontScale:Pe,languageName:j?.name}),h?.mode==="srs"?e.jsxs("div",{className:"practiceDock",style:{marginTop:14},children:[e.jsx("div",{className:"practiceDockPrimary",children:e.jsx("button",{className:"btn big primary",onClick:ne,title:"Play (P)",children:"Play"})}),e.jsxs("div",{className:"practiceDockRatings",children:[e.jsx("button",{className:"btn big",onClick:()=>Y("again"),title:"Again (1)",children:"Again"}),e.jsx("button",{className:"btn big",onClick:()=>Y("hard"),title:"Hard (2)",children:"Hard"}),e.jsx("button",{className:"btn big primary",onClick:()=>Y("good"),title:"Good (3)",children:"Good"}),e.jsx("button",{className:"btn big",onClick:()=>Y("easy"),title:"Easy (4)",children:"Easy"})]})]}):e.jsxs("div",{className:"practiceDock",style:{marginTop:14},children:[e.jsxs("div",{className:"practiceDockPrimary",children:[e.jsx("button",{className:"btn big",onClick:()=>le(-1,!0),title:"Previous (Left arrow)",children:"Prev"}),e.jsx("button",{className:"btn big primary",onClick:()=>{U?ee(n=>!n):ne()},title:U?ie?"Resume auto (Space)":"Pause auto (Space)":"Play (Space / P)",children:U?ie?"Resume":"Pause":"Play"}),e.jsx("button",{className:"btn big",onClick:()=>le(1,!0),title:"Next (Right arrow)",children:"Next"})]}),e.jsxs("div",{className:"practiceDockSecondary",children:[e.jsx("button",{className:"btn big "+(U?"primary":""),title:U?ie?"Auto is paused. Press Space or tap Resume.":"Auto is on. Press Space or tap Pause.":"Turn on auto mode",onClick:()=>{Le(n=>{const m=!n;return m&&ee(!1),m})},children:U?ie?"Auto (paused)":"Auto: on":"Auto: off"}),U?e.jsx("button",{className:"btn big",onClick:ne,title:"Play once (P)",children:"Play once"}):null]})]}),e.jsxs("div",{className:"miniRow",style:{marginTop:12},children:[e.jsx("button",{className:"chip",onClick:()=>Ve(n=>!n),children:ve?"Hide English":"Show English"}),de||Nt?e.jsx("button",{className:"chip",onClick:()=>qe(n=>!n),children:de?"Hide translit":"Show translit"}):null,ue||Tt?e.jsx("button",{className:"chip",onClick:()=>ze(n=>!n),children:ue?"Hide gloss":"Show gloss"}):null,e.jsx("button",{className:"chip",onClick:()=>{R?.targetText&&navigator.clipboard.writeText(R.targetText).then(()=>l("Copied"))},children:"Copy target"}),e.jsx("button",{className:"chip",onClick:()=>pe(!0),title:"Keyboard shortcuts ( ? )",children:"Shortcuts"})]})]}):null,r==="library"?e.jsxs("div",{style:{marginTop:18},children:[e.jsxs("div",{className:"panel",style:{padding:18},children:[e.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",gap:10},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:900,fontSize:18},children:"Library & Import"}),e.jsx("div",{style:{color:"var(--muted)",fontSize:13,marginTop:4},children:"Import sentences, add languages, and manage backups."})]}),e.jsxs("div",{className:"row",style:{gap:10,flexWrap:"wrap",justifyContent:"flex-end"},children:[e.jsx("button",{className:"btn",onClick:()=>Z(!0),children:"New language"}),e.jsx("button",{className:"btn nav",onClick:()=>{ge(!1),N()},title:"Back",children:"Back"})]})]}),e.jsxs("div",{className:"row",style:{marginTop:12,gap:10,flexWrap:"wrap"},children:[e.jsxs("div",{style:{width:"100%"},children:[e.jsx("div",{className:"sectionLabel",children:"Step one — Choose language and path"}),e.jsx("div",{className:"sectionHint",children:"Imports go into the selected path."})]}),e.jsx("select",{className:"btn",value:b,onChange:n=>D(n.target.value),style:{minWidth:220},children:k.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))}),e.jsx("select",{className:"btn",value:y,onChange:n=>F(n.target.value),style:{minWidth:220},children:O.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))}),e.jsx("button",{className:"btn",onClick:async()=>{if(!j)return;const n=prompt("New path name (for this language):","Main");if(!n)return;const m=await He(j.id,n);await Fe(j.id,m.id);const T=await d.decks.where("datasetId").equals(j.id).sortBy("createdAt");_(T),F(m.id)},children:"New path"})]}),j&&f?e.jsxs("div",{style:{marginTop:14},children:[e.jsx("div",{className:"sectionLabel",children:"Step two — Import sentences"}),e.jsx("div",{className:"sectionHint",children:"Upload a CSV / TSV / XLSX with at least English and Target."}),e.jsx(Ht,{dataset:j,deck:f,decks:O,onSelectDeck:F,onCreateDeck:()=>{},showPickers:!1,forceShowTips:yt,onImported:async()=>{await J(),await te(),ge(!1),l("Imported")},onToast:l})]}):null,b&&y?e.jsxs("div",{className:"panel",style:{padding:14,marginTop:12},children:[e.jsx("div",{className:"sectionLabel",children:"Step three — Manage imports (optional)"}),e.jsx("div",{className:"sectionHint",children:"Delete a past import from this path, or undo the most recent one. (Your data is local-first.)"}),e.jsxs("div",{className:"row",style:{marginTop:10,gap:10,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn",disabled:je.length===0,onClick:async()=>{const n=je[0];!n||!confirm(`Undo last import: ${n.fileName||"Import"}?`)||(await Ke(b,y,n.id),await J(),await te(),l("Last import removed"))},children:"Undo last import"}),e.jsx("button",{className:"btn",onClick:()=>ft(n=>!n),children:Xe?"Hide import list":"Show import list"}),e.jsx("button",{className:"btn",onClick:async()=>{confirm("Clear this entire path? (Keeps other paths and languages.)")&&(await Ce(b,y),await J(),await te(),l("Path cleared"))},children:"Clear this path"})]}),Xe?e.jsx("div",{style:{marginTop:10},children:je.length===0?e.jsx("div",{style:{color:"var(--muted)",fontSize:13},children:"No imports yet for this path."}):e.jsx("div",{className:"list",children:je.slice(0,20).map(n=>e.jsxs("div",{className:"listRow",style:{alignItems:"center"},children:[e.jsxs("div",{style:{flex:1,minWidth:220},children:[e.jsx("div",{style:{fontWeight:800},children:n.fileName||"Import"}),e.jsxs("div",{style:{color:"var(--muted)",fontSize:12,marginTop:2},children:[n.rowCount," rows • ",new Date(n.createdAt).toLocaleString()]})]}),e.jsx("button",{className:"btn btn-small",onClick:async()=>{confirm(`Delete this import: ${n.fileName||"Import"}?`)&&(await Ke(b,y,n.id),await J(),await te(),l("Import deleted"))},children:"Delete"})]},n.id))})}):null]}):null,e.jsxs("div",{className:"panel",style:{padding:14,marginTop:12},children:[e.jsx("div",{className:"sectionLabel",children:"Step four — Backup (recommended)"}),e.jsx("div",{className:"sectionHint",children:"Sentence Paths is local-first. Back up your library before switching devices or clearing browser data."}),e.jsxs("div",{className:"row",style:{marginTop:10,gap:10,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn primary",onClick:async()=>{const{exportAllToJSON:n}=await $(async()=>{const{exportAllToJSON:T}=await import("./backup-cf30dc23.js");return{exportAllToJSON:T}},__vite__mapDeps([4,1,2,3])),m=await n();is("sentencepaths_backup.json",m,"application/json"),l("Backup downloaded")},children:"Back up data"}),e.jsx("button",{className:"btn primary",onClick:async()=>{const n=document.createElement("input");n.type="file",n.accept=".json,application/json",n.onchange=async()=>{const m=n.files?.[0];if(!m)return;const T=await m.text(),{importAllFromJSON:w}=await $(async()=>{const{importAllFromJSON:I}=await import("./backup-cf30dc23.js");return{importAllFromJSON:I}},__vite__mapDeps([4,1,2,3]));await w(T),await tt(),await J(),await te(),l("Restored")},n.click()},children:"Restore backup"})]})]})]}),e.jsx("div",{style:{marginTop:12},children:e.jsx("button",{className:"btn btn-small",onClick:()=>xt(n=>!n),children:Ze?"Hide advanced tools":"Advanced tools"})}),Ze?e.jsx(Ft,{languages:k,currentLanguageId:b,onAddLanguage:async(n,m)=>{await st(n,m)},onRenameLanguage:async(n,m)=>{const T=await d.datasets.get(n);if(!T)return;await d.datasets.put({...T,name:m});const w=await d.datasets.orderBy("createdAt").toArray();S(w),l("Renamed")},onDeleteLanguage:async(n,m)=>{if(n===m)return;const w=(await d.sentences.where("datasetId").equals(n).toArray()).map(A=>({...A,datasetId:m}));await d.transaction("rw",[d.sentences,d.datasets],async()=>{w.length&&await d.sentences.bulkPut(w),await d.datasets.delete(n)});const I=await d.datasets.orderBy("createdAt").toArray();S(I),b===n&&D(m),l("Deleted")}}):null]}):null,e.jsx(Ne,{open:_e,title:"New language",onClose:()=>Z(!1),children:e.jsxs("div",{className:"helpStack",children:[e.jsxs("div",{style:{color:"var(--muted)",lineHeight:1.5},children:["Add a language, then import a sheet of sentences. Minimum columns: ",e.jsx("strong",{children:"English"})," and ",e.jsx("strong",{children:"Target"}),"."]}),e.jsxs("div",{className:"panel",style:{padding:14},children:[e.jsx("div",{style:{fontWeight:800,marginBottom:8},children:"Language name"}),e.jsx("input",{className:"btn",value:$e,onChange:n=>Je(n.target.value),placeholder:"e.g., French",style:{width:"100%"}}),e.jsx("div",{style:{fontWeight:800,marginTop:12,marginBottom:8},children:"Language tag (optional)"}),e.jsx("input",{className:"btn",value:Ye,onChange:n=>Qe(n.target.value),placeholder:"e.g., fr-FR",style:{width:"100%"}}),e.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:10,marginTop:14,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn",onClick:()=>Z(!1),children:"Cancel"}),e.jsx("button",{className:"btn primary",onClick:async()=>{const n=$e.trim();if(!n){l("Please enter a language name");return}await st(n,Ye.trim()),Je(""),Qe(""),Z(!1)},children:"Create"})]})]})]})}),e.jsx(Ne,{open:De,title:"Help & setup",onClose:()=>he(!1),children:e.jsxs("div",{className:"helpStack",children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:900,marginBottom:6},children:"Getting started"}),e.jsxs("ol",{style:{margin:0,paddingLeft:18,color:"var(--muted)",lineHeight:1.6},children:[e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Library & Import"})," in the top bar. (Tip: the top-left ",e.jsx("strong",{children:"Sentence Paths"})," title is a ",e.jsx("strong",{children:"Home"})," button.)"]}),e.jsxs("li",{children:["Choose a ",e.jsx("strong",{children:"language"})," and ",e.jsx("strong",{children:"path"}),", or press ",e.jsx("strong",{children:"New language"}),"."]}),e.jsxs("li",{children:["Press ",e.jsx("strong",{children:"Download template"})," (XLSX / CSV / TSV) or use ",e.jsx("strong",{children:"Interlinear Studio"})," to generate a sheet."]}),e.jsxs("li",{children:["Press ",e.jsx("strong",{children:"Choose file"})," to import. If you imported the wrong thing, use ",e.jsx("strong",{children:"Undo last import"})," or delete an import in the import list."]}),e.jsxs("li",{children:["Press ",e.jsx("strong",{children:"Back"}),", then ",e.jsx("strong",{children:"Start practice"}),". Use ",e.jsx("strong",{children:"Read"})," (book mode) or ",e.jsx("strong",{children:"Review"})," (spaced repetition)."]}),e.jsxs("li",{children:["Press ",e.jsx("strong",{children:"?"})," anytime to see keyboard shortcuts."]}),e.jsxs("li",{children:["Back up regularly: ",e.jsx("strong",{children:"Library & Import → Back up data"}),". Restore on a new device with ",e.jsx("strong",{children:"Restore backup"}),"."]})]})]}),e.jsxs("div",{className:"panel",style:{padding:14},children:[e.jsx("div",{style:{fontWeight:900,marginBottom:6},children:"Generate your import sheet"}),e.jsxs("div",{style:{color:"var(--muted)",lineHeight:1.5},children:["Use ",e.jsx("strong",{children:"Interlinear Studio"})," to generate or clean a sheet in the exact two / three / four-column format Sentence Paths imports. Template headers are detected automatically (for example, “Target Language (Greek)” works)."]}),e.jsx("div",{style:{marginTop:10},children:e.jsx("a",{className:"btn primary",href:Te,target:"_blank",rel:"noreferrer",style:{textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center"},children:"Open Interlinear Studio"})})]}),e.jsxs("div",{className:"panel",style:{padding:14},children:[e.jsx("div",{style:{fontWeight:900,marginBottom:6},children:"Backup reminder"}),e.jsxs("div",{style:{color:"var(--muted)",lineHeight:1.5},children:["Sentence Paths is local-first. Back up your library regularly: ",e.jsx("strong",{children:"Library & Import → Back up data"}),"."]})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:900,marginBottom:6},children:"Install as an app"}),e.jsx(zt,{})]})]})}),e.jsx(Ne,{open:Ee,title:"Keyboard shortcuts",onClose:()=>pe(!1),children:e.jsxs("div",{className:"helpStack",children:[e.jsxs("div",{style:{color:"var(--muted)",lineHeight:1.5},children:["Tips: shortcuts work when you are not typing in a field. Press ",e.jsx("strong",{children:"Esc"})," to return Home, or close this window."]}),e.jsxs("div",{className:"panel",style:{padding:14},children:[e.jsx("div",{style:{fontWeight:900,marginBottom:8},children:"Global"}),e.jsxs("div",{className:"shortcutGrid",children:[e.jsx("div",{className:"k",children:"?"}),e.jsx("div",{children:"Toggle shortcuts"}),e.jsx("div",{className:"k",children:"H"}),e.jsx("div",{children:"Open help"}),e.jsx("div",{className:"k",children:"S"}),e.jsx("div",{children:"Open settings"}),e.jsx("div",{className:"k",children:"L"}),e.jsx("div",{children:"Open library & import"}),e.jsx("div",{className:"k",children:"N"}),e.jsx("div",{children:"New language (in library)"}),e.jsx("div",{className:"k",children:"Backspace"}),e.jsx("div",{children:"Back (in library)"}),e.jsx("div",{className:"k",children:"Esc"}),e.jsx("div",{children:"Home"})]})]}),e.jsxs("div",{className:"panel",style:{padding:14},children:[e.jsx("div",{style:{fontWeight:900,marginBottom:8},children:"Practice (Read mode)"}),e.jsxs("div",{className:"shortcutGrid",children:[e.jsx("div",{className:"k",children:"Space"}),e.jsx("div",{children:"Play audio (or pause/resume auto)"}),e.jsx("div",{className:"k",children:"P"}),e.jsx("div",{children:"Play audio"}),e.jsx("div",{className:"k",children:"←"}),e.jsx("div",{children:"Previous sentence"}),e.jsx("div",{className:"k",children:"→"}),e.jsx("div",{children:"Next sentence"}),e.jsx("div",{className:"k",children:"A"}),e.jsx("div",{children:"Toggle auto mode"}),e.jsx("div",{className:"k",children:"E"}),e.jsx("div",{children:"Show/hide English"}),e.jsx("div",{className:"k",children:"T"}),e.jsx("div",{children:"Show/hide transliteration"}),e.jsx("div",{className:"k",children:"G"}),e.jsx("div",{children:"Show/hide gloss"}),e.jsx("div",{className:"k",children:"C"}),e.jsx("div",{children:"Copy target text"}),e.jsx("div",{className:"k",children:"M"}),e.jsx("div",{children:"Toggle Read / Review"})]})]}),e.jsxs("div",{className:"panel",style:{padding:14},children:[e.jsx("div",{style:{fontWeight:900,marginBottom:8},children:"Practice (Review mode)"}),e.jsxs("div",{className:"shortcutGrid",children:[e.jsx("div",{className:"k",children:"P"}),e.jsx("div",{children:"Play audio"}),e.jsx("div",{className:"k",children:"1"}),e.jsx("div",{children:"Again"}),e.jsx("div",{className:"k",children:"2"}),e.jsx("div",{children:"Hard"}),e.jsx("div",{className:"k",children:"3"}),e.jsx("div",{children:"Good"}),e.jsx("div",{className:"k",children:"4"}),e.jsx("div",{children:"Easy"}),e.jsx("div",{className:"k",children:"M"}),e.jsx("div",{children:"Toggle Read / Review"})]})]})]})}),e.jsxs(Ne,{open:Re,title:"Settings",onClose:()=>me(!1),children:[j?e.jsx(Gt,{dataset:j,onUpdate:async n=>{const m={...j,...n};await d.datasets.put(m);const T=await d.datasets.orderBy("createdAt").toArray();S(T),l("Saved")},voices:t.voices,onTestVoice:()=>{j&&(t.prime(),t.speak("Voice test.",{lang:j.languageTag||"und",rate:j.ttsRate??1,pitch:j.ttsPitch??1,voiceURI:j.preferredVoiceURI}))}}):null,t.isIOS&&!t.unlocked?e.jsxs("div",{className:"panel",style:{padding:14,marginTop:12},children:[e.jsx("div",{style:{fontWeight:900,marginBottom:6},children:"Unlock TTS on iOS"}),e.jsxs("div",{style:{color:"var(--muted)",lineHeight:1.5},children:["iOS requires a user tap before speech can play. Tap the button once, then use ",e.jsx("strong",{children:"Play"}),"."]}),e.jsx("div",{style:{marginTop:10},children:e.jsx("button",{className:"btn primary",onClick:()=>{t.prime(),l("TTS unlocked")},children:"Unlock"})})]}):null,e.jsxs("div",{className:"panel",style:{padding:14,marginTop:12},children:[e.jsx("div",{style:{fontWeight:900,marginBottom:10},children:"Auto settings"}),e.jsxs("div",{className:"row",style:{gap:10,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn "+(we?"primary":""),onClick:()=>jt(n=>!n),children:we?"English TTS: on":"English TTS: off"}),e.jsx("button",{className:"btn "+(oe==="audio"?"primary":""),onClick:()=>et("audio"),children:"Auto after audio"}),e.jsx("button",{className:"btn "+(oe==="delay"?"primary":""),onClick:()=>et("delay"),children:"Auto after delay"}),e.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[e.jsx("span",{style:{color:"var(--muted)",fontSize:13},children:"Delay"}),e.jsx("input",{className:"btn",type:"number",step:.5,min:0,max:10,value:fe,onChange:n=>vt(re(parseFloat(n.target.value||"0"),0,10)),style:{width:92}}),e.jsx("span",{style:{color:"var(--muted)",fontSize:13},children:"sec"})]})]})]}),e.jsxs("div",{className:"panel",style:{padding:14,marginTop:12},children:[e.jsx("div",{style:{fontWeight:900,marginBottom:6},children:"Troubleshooting"}),e.jsxs("div",{style:{color:"var(--muted)",lineHeight:1.5},children:["If the app looks stuck on an older version, use ",e.jsx("strong",{children:"Refresh app files"})," (keeps your local library). If you ever see a browser IndexedDB error (for example, ",e.jsx("strong",{children:'"transaction has finished"'}),"), a ",e.jsx("strong",{children:"Reset"})," usually fixes it."]}),e.jsxs("div",{className:"row",style:{marginTop:10,gap:10,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn",onClick:()=>{v()},title:"Clears PWA caches and reloads (keeps your language data)",children:"Refresh app files (keep data)"}),e.jsx("button",{className:"btn",onClick:async()=>{if(confirm(`Reset local Sentence Paths data on this device?

This will delete your local library (languages, paths, progress).
Back up first if you need it.`)){try{await d.delete()}catch{}location.reload()}},title:"Deletes local IndexedDB data and reloads",children:"Reset local data"})]})]})]}),s?e.jsx("div",{className:"toast",children:s.msg}):null,e.jsx("footer",{style:{marginTop:30,color:"var(--muted)",fontSize:12,textAlign:"center"},children:L?e.jsxs("span",{children:["Unique target words seen: ",L]}):null})]})}At.createRoot(document.getElementById("root")).render(e.jsx(Ct.StrictMode,{children:e.jsx(os,{})}));export{Ie as c,d,ce as m};
