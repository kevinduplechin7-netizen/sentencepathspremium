import{d as t}from"./index-5e1a8343.js";import"./react-bc301c2f.js";import"./dexie-d9f8aec0.js";import"./vendor-7461c230.js";async function x(){const p=await t.datasets.toArray(),a=await t.decks.toArray(),o=await t.imports.toArray(),i=await t.sentences.toArray(),n=await t.progress.toArray(),c=await t.pathProgress.toArray(),l=await t.srs.toArray(),g=await t.stats.toArray(),u=await t.seenWords.toArray();return JSON.stringify({datasets:p,decks:a,imports:o,sentences:i,progress:n,pathProgress:c,srs:l,stats:g,seenWords:u},null,2)}function b(p,a){const o=[...a],i=new Map;for(const n of o){const c=i.get(n.datasetId)??[];c.push(n),i.set(n.datasetId,c)}for(const n of p)(i.get(n.id)??[]).length===0&&o.push({id:`deck_${n.id}`,datasetId:n.id,name:"Main",createdAt:n.createdAt??Date.now()});return o}async function J(p){const a=JSON.parse(p),o=a.datasets??[],i=a.decks??[],n=a.imports??[],c=a.sentences??[],l=a.progress??[],g=a.pathProgress??[],u=a.srs??[],I=a.stats??[],y=a.seenWords??[],h=b(o,i),f=new Map;for(const s of o){const r=h.find(e=>e.datasetId===s.id)??null;r&&f.set(s.id,r.id)}const k=[...c];if(k.some(s=>!("deckId"in s)||!("order"in s)||!("importId"in s))){const s=new Map;for(const r of k){const e=s.get(r.datasetId)??[];e.push(r),s.set(r.datasetId,e)}for(const[r,e]of s.entries()){const w=f.get(r)??`deck_${r}`;e.sort((d,A)=>String(d.id).localeCompare(String(A.id)));for(let d=0;d<e.length;d++)e[d].deckId=w,e[d].order=d,e[d].importId=e[d].importId??"legacy"}}let m=[...g];if(m.length===0)for(const s of o){const r=f.get(s.id)??`deck_${s.id}`,e=l.find(d=>d.datasetId===s.id),w=e?.currentIndex??0;m.push({datasetId:s.id,deckId:r,mode:"linear",linearOrder:w,srsNewOrder:w,lifetimeReps:e?.lifetimeReps??0,lifetimeTokens:e?.lifetimeTokens??0,updatedAt:Date.now()})}const P=I.length?I:o.map(s=>({datasetId:s.id,uniqueWordsSeen:0,updatedAt:Date.now()}));await t.transaction("rw",[t.datasets,t.decks,t.imports,t.sentences,t.progress,t.pathProgress,t.srs,t.stats,t.seenWords],async()=>{if(await t.datasets.clear(),await t.decks.clear(),await t.imports.clear(),await t.sentences.clear(),await t.progress.clear(),await t.pathProgress.clear(),await t.srs.clear(),await t.stats.clear(),await t.seenWords.clear(),await t.datasets.bulkPut(o),await t.decks.bulkPut(h),await t.imports.bulkPut(n),await t.sentences.bulkPut(k),l.length)await t.progress.bulkPut(l);else{const s=o.map(r=>({datasetId:r.id,lifetimeReps:0,lifetimeTokens:0,currentIndex:0,updatedAt:Date.now()}));await t.progress.bulkPut(s)}await t.pathProgress.bulkPut(m),u.length&&await t.srs.bulkPut(u),await t.stats.bulkPut(P),y.length&&await t.seenWords.bulkPut(y)})}export{x as exportAllToJSON,J as importAllFromJSON};
